---
ebook:
  theme: one-dark.css
  title: Photon
  authors: Escatrgot
  disable-font-rescaling: true
  margin: [0.1, 0.1, 0.1, 0.1]
---
<style>
        h2:not(.tit) { border-top: 12px solid #143666; border-left: 5px solid #143666; border-right: 5px solid #143666; background-color: #143666; color: #FFF !important; font-weight: bold;}

    h3:not(.tit) { border-top: 3px solid #004480; border: 2px solid #004480; background-color: #004480; color: #FFF !important;}


    h4:not(.tit) { font-weight: bold; color: #FFF !important; }

    summary { cursor:pointer; font-weight:bold; color : #0F0 !important;}

    .red{color: #d93d3d;}
    .darkred{color: #470909;}
    .orange{color: #cf6d1d;}
    .yellow{color: #DD3;}
    .green{color: #25ba00;}
    .blue{color: #169ae0;}
    .pink{color: #d10fd1;}
    .dim{color : #666666;}
    .lime{color : #addb40;}
    
    .container {
        display : flex; 
        flex-direction:row;
        align-items:center;
    }
    .item {
        margin-right:2%;
    }

    @media screen and (min-width:1001px){
        .container {
            width: 90%;
            flex-wrap : nowrap;
            justify-content:center;
        }
    }
    
    @media screen and (max-width:1000px){
        .container {
            width: 98%;
            flex-wrap : nowrap;
            justify-content:center;
        }
    }
    
    @media screen and (max-width:799px){
        .container {
            justify-content:left;
            flex-wrap : wrap;
        }
    }

</style>

## 🔄 로비

* Photon Cloud로 애플리케이션 관리를 하고,
* Animator와 Animation으로 CharacterContoller 사용하는법
* 네트워크상의 변수 동기화
  * 씬의 동기화
  * 플레이어의 변수 동기화 
  * 플레이어 PhotonView를 통한 IObservable들 동기화

---

### 📄 1. 서버 접속

```
#region MonoBehaviour Callbacks
Awake() 
    타이밍 : OnInstantiate
    마스터 클라를 포함한 모든 클라이언트가 자동으로 씬 동기화를 하는 설정 세팅

#region Public Method
Contect() 
    타이밍 : On Press Enter Room 
```

#### 1). `PhotonNetwork.ConnectUsingSettings()`

* 역할
  : 오프라인 모드에서는 사용할 수 없다(method will disable OfflineMode (which won't destroy any instantiated GOs))
  "PhotonServerSetting.Asset"에 저장된 세팅을 가지고, 호스트한 서버의 주소, 등등을 사용해서 PhotonCloud에 연결/접속을 한다.
  : 에러콜백 `IConnectionCallbacks.OnDisconnected()`

---

### 📄 2. 룸 접근과 생성

#### 1). `bool PhotonNetwork.JoinRandomRoom(roomName, expectedUsernames)`

* 역할 
  : roomName으로 방을 접속한다
    로비에서 방 참가, 혹은 "expectedUsernames"로 함꼐 들어갈 유저를 작성할 수 있다는 점이 유용하다.
  : 콜백/에러콜백 `OnJoinedRoom()` ,`OnJoinedRoomFailed()`

---

### 📄 4. Launcher UI 

```
1. UnityEngine.UI.PlayerNameInputField 에 기입한 텍스트를 PhotonNetwork.Name에 대입한다
2. Button을 통한 직접 구현한 Connect 함수로 연결 시도를 하고, UI의 활성 상태를 전환한다.
    이걸 보고 떠올린 것은 웹 서비스는 UI의 상태관리를 어떻게 하지?
    React에서 확인해 볼 수 있지 않을까?
3. IConnectionCallbacks인터페이스의 OnDisconnect()콜백을 구현하고, 이떄도 UI의 활성 상태를 전환한다.
```

---

### 📄 5. 고민해 볼 문제.

#### UI의 상태 관리하다 겪었던 문제

* 너무 쓸데 없는 하드코딩으로 상태를 관리하게 된다.
  * 이전 경험에서는 상태마다 각각 함수나 클래스를 구현했다.
    ```cs
    /* Try Connect UI State */
    progressLabel.SetActive(true);
    controlPanel.SetActive(false);

    /* When Disconnect UI */
    progressLabel.SetActive(false);
    controlPanel.SetActive(true);
    ```
* 이떄도 FSM 상태 패턴으로 관리해야 하는건가?

* 혹시 React의 컴포넌트 state를 배우면 단서를 얻을 수 있지 않을까?
  UI의 상태 관리에 대한 툴도 한번 확인해 보자.
