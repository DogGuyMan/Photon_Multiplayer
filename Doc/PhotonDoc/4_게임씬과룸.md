---
ebook:
  theme: one-dark.css
  title: Photon
  authors: Escatrgot
  disable-font-rescaling: true
  margin: [0.1, 0.1, 0.1, 0.1]
---
<style>
        h2:not(.tit) { border-top: 12px solid #143666; border-left: 5px solid #143666; border-right: 5px solid #143666; background-color: #143666; color: #FFF !important; font-weight: bold;}

    h3:not(.tit) { border-top: 3px solid #004480; border: 2px solid #004480; background-color: #004480; color: #FFF !important;}


    h4:not(.tit) { font-weight: bold; color: #FFF !important; }

    summary { cursor:pointer; font-weight:bold; color : #0F0 !important;}

    .red{color: #d93d3d;}
    .darkred{color: #470909;}
    .orange{color: #cf6d1d;}
    .yellow{color: #DD3;}
    .green{color: #25ba00;}
    .blue{color: #169ae0;}
    .pink{color: #d10fd1;}
    .dim{color : #666666;}
    .lime{color : #addb40;}
    
    .container {
        display : flex; 
        flex-direction:row;
        align-items:center;
    }
    .item {
        margin-right:2%;
    }

    @media screen and (min-width:1001px){
        .container {
            width: 90%;
            flex-wrap : nowrap;
            justify-content:center;
        }
    }
    
    @media screen and (max-width:1000px){
        .container {
            width: 98%;
            flex-wrap : nowrap;
            justify-content:center;
        }
    }
    
    @media screen and (max-width:799px){
        .container {
            justify-content:left;
            flex-wrap : wrap;
        }
    }

</style>

## ğŸ”„ ê²Œì„ ì”¬ê³¼ ë£¸(ë ˆë²¨)

### ğŸ“„ 1. ë°© ë– ë‚˜ê¸° ë¡œì§ ì²˜ë¦¬
í”Œë ˆì´ì–´ ìˆ˜ì— ë”°ë¼ ì ì •í•œ ë ˆë²¨ì„ ë¡œë“œí•˜ëŠ” ë¡œì§ì„ êµ¬í˜„ í•  ê²ƒ

```cs
/* GameManager.SceneManagement.cs */
ë°© ë– ë‚˜ê¸° ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ GameManager

1.  "Exit Room Button" UI Button í´ë¦­ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜
    LeaveRoom(){PhotonNetwork.LeaveRoom();}

2.  IMatchmakingCallbacks.OnLeftRoom() ì½œë°±ì´ í˜¸ì¶œë˜ë©°, 
    ì´ë•Œ UnityEngine.SceneManagement.SceneManager.LoadScene(int index);
    ë¥¼ í˜¸ì¶œí•˜ê²Œ ëœë‹¤.

```

#### 1). `PhotonNetwork.LeaveRoom()`

  * ì„¤ëª… 
    :   í”Œë ˆì´ ì¤‘ì´ì˜€ë˜ í˜„ì¬ ë£¸ì„ ë– ë‚˜ë©´ì„œ *(PhotonServer's GameServer ì—ì„œ ë– ë‚œë‹¤)*
        ê·¸ë¦¬ê³  ë°©ì„ ìƒì„±í•˜ê³  Join í–‰ë™ì„ í•˜ë˜ ì”¬ìœ¼ë¡œ ëŒì•„ê°„ë‹¤ *(PhotonServer's Master Serverë¡œ ëŒì•„ê°„ë‹¤.)*
        ê·¸ë¦¬ê³  ì—°ê²°ìƒíƒœëŠ” OfflineModeë¡œ ë³€í•œë‹¤. ì´ì™€ ë™ì‹œì— "PhotonViewì™€ Network GameObject"ê°€ í´ë¦° ì—… ë  ê²ƒì´ë‹¤.
        ê·¸ë¦¬ê³  ì¦‰ì‹œ `IMatchmakingCallbacks.OnLeftRoom()`ì´ í˜¸ì¶œëœë‹¤.
    : ë§Œì•½ ë£¸ì— ë‚¨ì•„ ìˆëŠ” í”Œë ˆì´ì–´ ìˆ˜ê°€
        * 1ëª…ì´ë¼ë„ ë‚¨ì•„ ìˆìœ¼ë©´ : ì„¸íŒ…ì— becomeInactiveê°€ true ìƒíƒœì—ì„œëŠ” 
            ì‚­ì œë˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë¹„í™œì„±(inactive) ëœë‹¤.
            ë”°ë¼ì„œ ë‚˜ì¤‘ì— ì¬ì ‘ì„ ìœ„í•´ í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì— ì—¬ì „íˆ ë‚¨ì•„ ìˆë‹¤.
            ë§Œì•½ becomeInactiveê°€ falseë¼ë©´ ì§„ì§œë¡œ ì‚­ì œí•œë‹¤.
        * í•˜ë‚˜ë„ ì—†ë‹¤ë©´ ê·¸ëƒ¥ : ë°© ìì²´ê°€ ì˜ë¯¸ ì—†ìŒ
  * ìš©ë¡€
    :   

### ğŸ“„ 2. í”Œë ˆì´ì–´ ìˆ˜ì— ê¸°ë°˜í•œ ë‹¤ì–‘í•œ ë ˆë²¨ ë¡œë”© ì²˜ë¦¬

```cs
/* GameManager.SceneManagement.cs */

ë ˆë²¨ì„ ë¡œë“œí•˜ëŠ” ë¡œì§ ë˜í•œ ì²˜ë¦¬í•˜ëŠ”ê²ƒì€ GameManagerì´ê¸°ë„ í•˜ë‹¤.

1.  ë§ˆìŠ¤í„° í´ë¼ì´ì–¸íŠ¸ì¸ì§€ ì•„ë‹Œì§€ í™•ì¸í•œë‹¤. ì´ê±¸ ì²´í¬í•˜ëŠ” ê²ƒì€ í˜¸ì¶œì í´ë¼ì´ì–¸íŠ¸ê°€ ë  ê²ƒì´ë‹¤. 
2.  ì˜¤ì§ ë§ˆìŠ¤í„° í´ë¼ì´ì–¸íŠ¸ë§Œ PhotonNetwork.LoadLevel(string) ì„ ìˆ˜í–‰í•˜ë„ë¡ í•œë‹¤.
    PhotonNetwork.automaticallySyncSceneì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ë§ˆìŠ¤í„° í´ë¼ì´ì–¸íŠ¸ì˜ ì”¬ì„ 
    ì ‘ì†í•œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ë™ê¸°í™” ë˜ë„ë¡ í•œë‹¤.

```

#### 1). [`PhotonNetwork.LoadLevel([int/string])`](https://doc-api.photonengine.com/en/pun/current/class_photon_1_1_pun_1_1_photon_network.html#aedba3c40295e3684fedc64acf678a5cd)

* ì„¤ëª…
    :   ë¹„ë™ê¸°ì ì¸ ì”¬ ì „í™˜ì„ ì œê³µ
        ë‹¨ ì£¼ì˜í•  ì ì´ ì´ë•ŒëŠ” ë„¤íŠ¸ì›Œí¬ ë©”ì„¸ì§€ê°€ ë©ˆì¶˜ë‹¤. 
        ë”°ë¼ì„œ ë©”ì„¸ì§€ ë””ìŠ¤íŒ¨ì³ë¥¼ í†µí•´ ë‹¤ë¥¸ í”Œë ˆì´ì–´ì˜ ë„¤íŠ¸ì›Œí¬ ë©”ì‹œì§€ë¥¼ ë°›ëŠ”ë‹¤.
    :   PhotonNetwork.AutomaticallySyncSceneì„ ì‚¬ìš©í•´ì•¼ì§€ 
        ë§ˆìŠ¤í„° í´ë¼ì´ì–¸íŠ¸ì— ì˜í•´ í˜¸ì¶œëœ ì”¬ ë¡œë“œê°€ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ì”¬ ë™ê¸°í™”ê°€ ê°€ëŠ¥í•´ì§„ë‹¤. 
        ë‹¤ë¥¸ ì”¬ í˜¸ì¶œì¤‘ì—ëŠ” RPCë¥¼ ì“°ë©´ ì•ˆëœë‹¤ëŠ”ê²ƒì„ ëª…ì‹¬í•´ì•¼ í•œë‹¤.
    " 

### ğŸ“„ 3. í”Œë ˆì´ì–´ ì°¸ê°€ & ë– ë‚˜ê¸° ì—°ê²° ê´€ì°°

```cs
/* GameManager.UserManagement.cs */

1. ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ Joiní• ë•Œ í˜¸ì¶œë  IInRoomCallbacks.OnPlayerEnderedRoom(Player other) ì½œë°± í˜¸ì¶œ êµ¬í˜„
2. ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ Leaveí• ë•Œ í˜¸ì¶œë  IInRoomCallbacks.OnPlayerLeftRoom(Player other) ì½œë°± í˜¸ì¶œ êµ¬í˜„

ìœ„ ë‘ê°€ì§€ ì²˜ë¦¬ì—ì„œ ê³µí†µì ìœ¼ë¡œ í•´ì•¼ í•˜ëŠ” ê²ƒì€ LoadArena() ì´ë©°, ì˜¤ì§ ë§ˆìŠ¤í„° í´ë¼ì´ì–¸íŠ¸ì— ì˜í•´ í˜¸ì¶œë˜ë„ë¡ í•´ì•¼í•œë‹¤.
```

### ğŸ“„ 4. Photon PUN2 ì˜ ì½œë°± ì‚¬ì´í´

#### ë ˆë²¨ì— ë– ë‚˜ê³  ë¡œë¹„ë¡œ ë‚˜ê°ˆë•Œ ì½œë°± í˜¸ì¶œì˜ ìˆœì„œ.

```cs
1. Exit Level Buttonìœ¼ë¡œ UIì— ì—°ê²°ëœ ì½œë°±   
    LeaveRoom() {PhotonNetwork.LeaveRoom()}
2. ì˜ì™¸ë¡œ IConnectionCallbacks.OnConnectedToMaster()ê°€ ë¨¼ì € í˜¸ì¶œëœë‹¤.
    ë”°ë¼ì„œ ëª¨ë“  "MonoBehaviourPunCallbacks" ìƒì† í´ë˜ìŠ¤ë¥¼ ìˆœíšŒ í•´ì„œ ì½œë°±ì„ ì‹¤í–‰í•˜ê³ , ê·¸ì¤‘.
    Launcher.OnConnectedToMaster(){... PhotonNetwork.JoinRandomRoom(); ...} ê°€ ì‹¤í–‰ëœë‹¤.
3. ê·¸ë¦¬ê³  ë‚˜ì„œ IMatchmakingCallbacks.OnLeftRoom()ê°€ ê·¸ì œì„œì•¼ í˜¸ì¶œëœë‹¤.
    ë”°ë¼ì„œ ëª¨ë“  "MonoBehaviourPunCallbacks" ìƒì† í´ë˜ìŠ¤ë¥¼ ìˆœíšŒ í•´ì„œ ì½œë°±ì„ ì‹¤í–‰í•˜ê³ , ê·¸ì¤‘.
    GameManager.OnLeftRoom() {... SceneManager.LoadScene("Launcher"); ...}
```

ì´ë ‡ê²Œ ë³´ë©´ ë¶„ëª… ë¡œë¹„ë¡œ ë‚˜ê°”ëŠ”ë° `PhotonNetwork.JoinRandomRoom()`ì€ ë­”ê°€ ì´ìƒí•˜ë‹¤.
ë”°ë¼ì„œ ê°•ì¢Œì—ì„œëŠ” ë§ˆìŠ¤í„° ì„œë²„ì— ì ‘ì† ì½œë°±ì´ ì‹¤í–‰ë ë–„
IsConnectingìœ¼ë¡œ ì¡°ê±´ ë¶„ê¸°ë¥¼ í•˜ê³ , ì˜¤ì§, ë¡œë¹„ì—ì„œ Connectê°€ ì‹¤í–‰ë ë•Œ, 
`IsConnecting = true` í”Œë˜ê·¸ë¥¼ ì„¸ì›Œì„œ í•´ê²°í–ˆë‹¤.

ê·¸ë˜ì„œ ì´ê²ƒ ë³´ë‹¨. 
íƒ€ì´í‹€ ë©”ë‰´ì—ì„œ LocalData ì´ˆê¸°í™” í• ë–„ ë™ì‹œì— Pun2 ì—°ê²°ë„ ì´ˆê¸°í™” í•´ì£¼ì.
ì´ë•Œ ì‚¬ìš©í•œ ê²ƒì€ `UniTask`ë¥¼ PUN2ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ `Pun2Task` íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ëŠ”ë‹¤.
ì´ë ‡ê²Œ í•˜ë©´ `OnConnectedToMaster` ì—ì„œ `PhotonNetwork.JoinRandomRoom()`ì˜ ì±…ì„ì„ ì™„ì „íˆ
"JoinRoom Launch Button" UIë¥¼ í†µí•´ `Connect()`ê°€ ì‹¤í–‰ ë˜ë„ë¡ ìœ„ì„í•˜ë©´ ë” ì¢‹ì€ê²ƒ ê°™ë‹¤.

---

### ğŸ“„ 5. ê³ ë¯¼í•´ ë³¼ ë¬¸ì œ.

#### 1). GameManagerì— UserManagement & SceneManagement ë“±ë“± ì„œë¡œ ë‹¤ë¥¸ ê¸°ëŠ¥ì´ ê²°í•©ë˜ì—ˆë‹¤.

* **ì´ëŠ” SRP ë‹¨ì¼ ì±…ì„ ì›ì¹™ì— ì–´ê¸‹ë‚œ ê²ƒì´ë‹¤.**
  * ë”°ë¼ì„œ ì´ëŸ¬í•œ ì±…ì„ë¶„ë¦¬ë¥¼ í•˜ëŠ” ê²ƒì´ ë” ìœ ìš©í•  ê²ƒ ê°™ë‹¤.

#### 2). LoadSceneì˜ ë™ì‘ì„ í•˜ëŠ” í´ë˜ìŠ¤ê°€ Launcher.cs, GameManager ë‘˜ë‹¤ ë¶„ì‚°ë˜ì–´ìˆë‹¤.

* **ì´ë§ì€ ì”¬ ì „í™˜ì´ë¼ëŠ” í–‰ë™ì´ ì‘ì§‘ë ¥ì´ ë‚®ë‹¤...**  
  * ë”°ë¼ì„œ ìœ„ì˜ ë¹„ìŠ·í•œ ë…¼ë¦¬ë¡œ ì±…ì„ ë¶„ë¦¬ë¥¼í•˜ì—¬ ì”¬ ì´ë™ê³¼ ê´€ë¦¬ì— ëŒ€í•´ ë§¤ë‹ˆì§• í•˜ëŠ” í´ë˜ìŠ¤ê°€ í•„ìš”í•´ ë³´ì¸ë‹¤.

#### 3). `SingletonMonobehaviour<T>` ì„ ë§Œë“¤ì—ˆì§€ë§Œ, ê³µë³€ì„± ë¬¸ì œë¡œ GameManagerì— ì‚¬ìš©í• ë•Œ ë¬¸ì œê°€ ìƒê¹€
* ì •í™•íˆëŠ” GameManagerëŠ” í˜„ì¬ `MonobehavoirPunCallback` ê°ì²´ë¥¼ ìƒì† ë°›ëŠ”ë°
  * SingletonMonobehaviourëŠ” Monobehavoir ìƒì†ì´ ì´ë¯¸ ë˜ì–´ ìˆì–´ì„œ ì´ê±¸ ì–´ë–»ê²Œ ì“¸ì§€ ì• ë§¤í•˜ë‹¤
    1. ì¼ë‹¨ ë– ì˜¤ë¥¸ í•´ê²°ë²•ì€ GameManagerê°€  `SingletonMonobehaviour<T>`ë¥¼ ìƒì†í•˜ë˜.
    Photon PUN2 ì½œë°±ì„ ì“°ê¸° ìœ„í•´ PunCallBack Interfaceë¥¼ êµ¬í˜„í•˜ë„ë¡í•˜ëŠ” ê²ƒì´ë‹¤.
    