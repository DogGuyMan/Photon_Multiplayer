---
ebook:
  theme: one-dark.css
  title: Photon
  authors: Escatrgot
  disable-font-rescaling: true
  margin: [0.1, 0.1, 0.1, 0.1]
---
<style>
        h2:not(.tit) { border-top: 12px solid #143666; border-left: 5px solid #143666; border-right: 5px solid #143666; background-color: #143666; color: #FFF !important; font-weight: bold;}

    h3:not(.tit) { border-top: 3px solid #004480; border: 2px solid #004480; background-color: #004480; color: #FFF !important;}


    h4:not(.tit) { font-weight: bold; color: #FFF !important; }

    summary { cursor:pointer; font-weight:bold; color : #0F0 !important;}

    .red{color: #d93d3d;}
    .darkred{color: #470909;}
    .orange{color: #cf6d1d;}
    .yellow{color: #DD3;}
    .green{color: #25ba00;}
    .blue{color: #169ae0;}
    .pink{color: #d10fd1;}
    .dim{color : #666666;}
    .lime{color : #addb40;}
    
    .container {
        display : flex; 
        flex-direction:row;
        align-items:center;
    }
    .item {
        margin-right:2%;
    }

    @media screen and (min-width:1001px){
        .container {
            width: 90%;
            flex-wrap : nowrap;
            justify-content:center;
        }
    }
    
    @media screen and (max-width:1000px){
        .container {
            width: 98%;
            flex-wrap : nowrap;
            justify-content:center;
        }
    }
    
    @media screen and (max-width:799px){
        .container {
            justify-content:left;
            flex-wrap : wrap;
        }
    }

</style>

## 🔄 게임 씬과 룸(레벨)

### 📄 1. 방 떠나기 로직 처리
플레이어 수에 따라 적정한 레벨을 로드하는 로직을 구현 할 것

```cs
/* GameManager.SceneManagement.cs */
방 떠나기 로직을 처리하는 것은 GameManager

1.  "Exit Room Button" UI Button 클릭시 실행될 함수
    LeaveRoom(){PhotonNetwork.LeaveRoom();}

2.  IMatchmakingCallbacks.OnLeftRoom() 콜백이 호출되며, 
    이때 UnityEngine.SceneManagement.SceneManager.LoadScene(int index);
    를 호출하게 된다.

```

#### 1). `PhotonNetwork.LeaveRoom()`

  * 설명 
    :   플레이 중이였던 현재 룸을 떠나면서 *(PhotonServer's GameServer 에서 떠난다)*
        그리고 방을 생성하고 Join 행동을 하던 씬으로 돌아간다 *(PhotonServer's Master Server로 돌아간다.)*
        그리고 연결상태는 OfflineMode로 변한다. 이와 동시에 "PhotonView와 Network GameObject"가 클린 업 될 것이다.
        그리고 즉시 `IMatchmakingCallbacks.OnLeftRoom()`이 호출된다.
    : 만약 룸에 남아 있는 플레이어 수가
        * 1명이라도 남아 있으면 : 세팅에 becomeInactive가 true 상태에서는 
            삭제되는게 아니라 비활성(inactive) 된다.
            따라서 나중에 재접을 위해 플레이어 리스트에 여전히 남아 있다.
            만약 becomeInactive가 false라면 진짜로 삭제한다.
        * 하나도 없다면 그냥 : 방 자체가 의미 없음
  * 용례
    :   

### 📄 2. 플레이어 수에 기반한 다양한 레벨 로딩 처리

```cs
/* GameManager.SceneManagement.cs */

레벨을 로드하는 로직 또한 처리하는것은 GameManager이기도 하다.

1.  마스터 클라이언트인지 아닌지 확인한다. 이걸 체크하는 것은 호출자 클라이언트가 될 것이다. 
2.  오직 마스터 클라이언트만 PhotonNetwork.LoadLevel(string) 을 수행하도록 한다.
    PhotonNetwork.automaticallySyncScene을 사용했기 때문에 마스터 클라이언트의 씬을 
    접속한 모든 클라이언트가 동기화 되도록 한다.

```

#### 1). [`PhotonNetwork.LoadLevel()`](https://doc-api.photonengine.com/en/pun/current/class_photon_1_1_pun_1_1_photon_network.html#aedba3c40295e3684fedc64acf678a5cd)

### 📄 3. 플레이어 참가 & 떠나기 연결 관찰

```
/* GameManager.UserManagement.cs */

1. 다른 플레이어가 Join할때 호출될 OnPlayerEnderedRoom(Player other) 콜백 호출 구현
2. 다른 플레이어가 Leave할때 호출될 OnPlayerLeftRoom(Player other) 콜백 호출 구현

위 두가지 처리에서 공통적으로 해야 하는 것은 LoadArena이며, 

```

### 📄 4. 로비에서 레벨 로딩

아직 룸에 들어가지 않았을때, 로비에서 룸을 불러 올 때,

### 📄 5. 
